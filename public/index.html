<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Stay updated on nationwide egg prices and trends. Our interactive chart and insights help you understand egg price fluctuations and make informed decisions.">
    <title>Nationwide Egg Prices - Stay Updated on Trends & Costs | EggPrices.org</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Host+Grotesk:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <style>
        /* Egg-themed colors */
        
         :root {
            --egg-yellow: #F2DA8A;
            --egg-white: #f5f0e6;
            --egg-brown: #d68c45;
            --dark-brown: #4b2e15;
            --light-gray: #f4f4f4;
            --democrat-blue: rgba(32, 74, 135, 0.1);
            --republican-red: rgba(164, 0, 0, 0.1);
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2563739074608905" crossorigin="anonymous"></script>
</head>

<body class="font-host bg-egg-yellow text-gray-800 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-dark-brown px-8 pb-4 pt-3 shadow-lg flex flex-row items-center justify-start">
        <div class="flex items-center justify-between border-r border-egg-white pr-8">
            <h1 class="text-3xl font-black text-egg-white">eggprices<span class="font-light">.org</span></h1>
        </div>
        <nav class="flex h-full flex-row items-end justify-between px-8 gap-4 pt-1">
            <a href="/" class="text-egg-white hover:text-egg-yellow border border-egg-white hover:border-egg-yellow duration-300 border-2 border-transparent rounded-md px-2 py-1">Nationwide Data</a>
            <a href="/" class="text-egg-yellow opacity-50 hover:text-egg-yellow border border-egg-yellow cursor-not-allowed border-2 border-dotted rounded-md px-2 py-1">Coming soon: Regional Data</a>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="w-full flex flex-col items-center flex-grow">
        <!-- Interactive Chart Section -->
        <div class="w-full flex flex-col gap-8 lg:flex-row p-8">
            <section class="bg-egg-white rounded-lg p-6 shadow-md w-full lg:w-2/3">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                    <div>
                        <div class="flex flex-row items-center gap-2 flex-wrap">
                            <h2 class="text-2xl font-light text-dark-brown text-nowrap">Egg Price Trends</h2>
                            <div class="text-egg-brown text-sm">
                                <span>Updated every 12 hours</span>
                                <span class="mx-2">â€¢</span>
                                <a href="https://www.bls.gov/data/" class="text-egg-brown hover:underline" target="_blank" rel="noopener">
                                    Source: Bureau of Labor Statistics <span class="text-xs">(APU0000708111)</span>
                                </a>
                            </div>
                        </div>
                        <div class="text-sm text-gray-600 mt-1">
                            Average price per dozen, Grade A Large Eggs
                        </div>
                    </div>
                </div>
                <div id="eggPriceChartContainer" class="w-full h-64 sm:h-96">
                    <canvas id="eggPriceChart" class="w-full"></canvas>
                </div>
            </section>
            <!-- Summary Section -->
            <section class="w-full lg:w-1/3">
                <div class="flex flex-row items-center justify-between">
                    <h2 class="text-xl font-semibold text-dark-brown">Quick Insights</h2>
                    <div class="mt-2 sm:mt-0">
                        <select id="timeScale" class="bg-egg-white border border-egg-brown text-dark-brown px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-egg-brown">
                            <option value="6">6 Months</option>
                            <option value="12">1 Year</option>
                            <option value="24">2 Years</option>
                            <option value="36">3 Years</option>
                            <option value="60">5 Years</option>
                            <option value="120" selected>10 Years</option>
                        </select>
                    </div>
                </div>
                <div class="flex flex-wrap gap-4 mt-4">
                    <div class="bg-egg-white p-4 rounded-lg shadow flex-grow shadow-md">
                        <h3 class="text-lg font-semibold text-dark-brown">Current Price</h3>
                        <div class="flex gap-1 items-end">
                            <p id="currentPrice" class="text-3xl font-bold text-egg-brown">--</p>
                            <span class="text-sm text-gray-500 pb-1">/ dozen</span>
                        </div>
                        <p id="currentDate" class="text-sm text-gray-600 mt-1">as of --</p>
                    </div>
                    <div class="bg-egg-white p-4 rounded-lg shadow flex-grow shadow-md">
                        <h3 class="text-lg font-semibold text-dark-brown">Average Price</h3>
                        <div class="flex gap-1 items-end">
                            <p id="averagePrice" class="text-3xl font-bold text-egg-brown">--</p>
                            <span class="text-sm text-gray-500 pb-1">/ dozen</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">selected period</p>
                    </div>
                    <div class="bg-egg-white p-4 rounded-lg shadow flex-grow shadow-md">
                        <h3 class="text-lg font-semibold text-dark-brown">Highest Price</h3>
                        <div class="flex gap-1 items-end">
                            <p id="highestPrice" class="text-3xl font-bold text-egg-brown">--</p>
                            <span class="text-sm text-gray-500 pb-1">/ dozen</span>
                        </div>
                        <p id="highestDate" class="text-sm text-gray-600 mt-1">reached --</p>
                    </div>
                    <div class="bg-egg-white p-4 rounded-lg shadow flex-grow shadow-md">
                        <h3 class="text-lg font-semibold text-dark-brown">Lowest Price</h3>
                        <div class="flex gap-1 items-end">
                            <p id="lowestPrice" class="text-3xl font-bold text-egg-brown">--</p>
                            <span class="text-sm text-gray-500 pb-1">/ dozen</span>
                        </div>
                        <p id="lowestDate" class="text-sm text-gray-600 mt-1">reached --</p>
                    </div>

                </div>
            </section>
        </div>

        <!-- About and News Grid Section -->
        <div class="px-8 mb-8 grid grid-cols-[300px_2fr_1fr] gap-8">
            <!-- Ad Space -->
            <aside class="space-y-4">
                <div class="bg-egg-white p-4 rounded-lg shadow-lg h-[600px] flex items-center justify-center text-gray-400">
                    Coming Soon: Regional Data
                </div>
            </aside>

            <!-- About Section -->
            <div id="aboutEggPrices" class="space-y-6">
                <!-- Current Prices Section -->
                <section class="space-y-4 bg-egg-white p-4 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold border-b-4 border-egg-yellow pb-2">Current Egg Prices and Historical Data
                    </h2>
                    <p class="text-lg leading-relaxed text-pretty">
                        Egg prices fluctuate due to supply chain issues, seasonal demand, feed costs, and production trends. At <span class="font-semibold">eggprices.org</span>, we monitor <span class="font-semibold">current egg prices</span> from trusted
                        sources like the <span class="font-semibold">Bureau of Labor Statistics</span>. Our dashboard provides:
                    </p>
                    <ul class="list-disc list-inside space-y-2">
                        <li><span class="font-semibold">Current average egg prices</span> for large, medium, and specialty eggs.</li>
                        <li><span class="font-semibold">Weekly and monthly trends</span> in egg costs.</li>
                        <li>A comprehensive view of <span class="font-semibold">historical egg prices</span> dating back to 2014.</li>
                    </ul>
                </section>

                <!-- Why Prices Change Section -->
                <section class="space-y-4 bg-egg-white p-4 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold border-b-4 border-egg-yellow pb-2">Why Do Egg Prices Change?</h2>
                    <p class="text-lg leading-relaxed text-pretty">
                        Understanding the factors that affect <span class="font-semibold">egg prices</span> is crucial. Key drivers include:
                    </p>
                    <ul class="list-disc list-inside space-y-2">
                        <li><span class="font-semibold">Feed Costs:</span> The price of hen feed impacts production costs.
                        </li>
                        <li><span class="font-semibold">Avian Influenza:</span> Outbreaks reduce supply, driving up prices.
                        </li>
                        <li><span class="font-semibold">Consumer Demand:</span> Holiday seasons and baking trends increase demand.</li>
                        <li><span class="font-semibold">Economic Conditions:</span> Inflation and supply chain disruptions also play a role.</li>
                    </ul>
                </section>


                <section class="space-y-4 bg-egg-white p-4 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold border-b-4 border-egg-yellow pb-2">Egg Price Trends for 2024</h2>
                    <p class="text-lg leading-relaxed text-pretty">
                        Are <span class="font-semibold">egg prices</span> going up or down in 2024? We provide insights and projections based on historical data and current trends, including:
                    </p>
                    <ul class="list-disc list-inside space-y-2">
                        <li>Regional variations in <span class="font-semibold">egg prices by state</span>.</li>
                        <li>Comparisons between conventional, organic, and free-range eggs.</li>
                        <li>Forecasts for the cost of eggs in the coming months.</li>
                    </ul>
                </section>


                <section class="space-y-4 bg-egg-white p-4 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold border-b-4 border-egg-yellow pb-2">Frequently Asked Questions</h2>

                    <div>
                        <h3 class="font-semibold text-lg">1. What is the average price of a dozen eggs in the US?</h3>
                        <p class="text-base">The average price varies by state and time of year. As of <span id="currentDateFAQ" class="font-semibold">--</span>, the national average is <span id="currentPriceFAQ" class="font-semibold">--</span>.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-lg">2. Why are egg prices so high?</h3>
                        <p class="text-base">Egg prices increase due to factors like reduced supply, higher production costs, and seasonal demand.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-lg">3. Are organic eggs more expensive?</h3>
                        <p class="text-base">Yes, organic eggs typically cost more due to higher production standards and feed costs.</p>
                    </div>

                </section>
            </div>


            <div class="space-y-6">
                <section class="bg-egg-white p-4 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold border-b-4 border-egg-yellow pb-2 mb-4">Latest Egg News</h2>
                    <div id="news-loading" class="text-center py-4 text-gray-600">Loading news...</div>
                    <div id="news-error" class="hidden text-center py-4 text-red-600">Failed to load news</div>
                    <ul id="news-feed" class="space-y-4">
                        <!-- News items will be dynamically injected here -->
                    </ul>
                </section>


                <!-- <section class="bg-egg-white p-4 rounded-lg shadow-lg text-center">
                    <h2 class="text-xl font-bold mb-2">Get Updates</h2>
                    <p class="text-sm mb-4">Stay informed about egg price changes</p>
                    <button
                        class="bg-egg-yellow text-dark-brown font-semibold px-8 py-2 rounded-lg hover:bg-egg-brown hover:text-egg-white transition">
                        Subscribe
                    </button>
                </section> -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-egg-brown text-egg-white py-4 mt-auto">
        <div class="max-w-6xl mx-auto text-center">
            <p>&copy; 2025 EggPrices.org. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        let currentChart = null; // Store the chart instance globally

        document.getElementById('timeScale').addEventListener('change', function(e) {
            const months = parseInt(e.target.value);
            fetchEggPrices(months);
        });

        async function fetchEggPrices(months = 120) {
            try {
                const response = await fetch(`/api/egg-prices?months=${months}`);
                const result = await response.json();
                const {
                    data
                } = result;

                // Prepare data for the chart
                const labels = data.map(item => item.periodName + ' ' + item.year);
                const prices = data.map(item => parseFloat(item.value));

                labels.reverse();
                prices.reverse();

                // Destroy existing chart if it exists
                if (currentChart) {
                    currentChart.destroy();
                }

                // Create new chart
                const ctx = document.getElementById("eggPriceChart").getContext("2d");
                currentChart = new Chart(ctx, {
                    type: "line",
                    data: {
                        labels,
                        datasets: [{
                            label: "Egg Prices",
                            data: prices,
                            borderColor: "var(--egg-brown)",
                            backgroundColor: "rgba(214, 140, 69, 0.1)",
                            borderWidth: 4,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 0,
                            pointHoverRadius: 3,
                            pointHoverBackgroundColor: "var(--egg-yellow)",
                            pointHoverBorderColor: "var(--dark-brown)",
                            pointHoverBorderWidth: 2,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        height: 200,
                        interaction: {
                            mode: 'index',
                            intersect: false, // This enables hover anywhere on the x-axis
                        },
                        plugins: {
                            legend: {
                                display: false
                            }, // Remove legend since we only have one dataset
                            tooltip: {
                                backgroundColor: 'rgba(244, 244, 244, 0.9)',
                                titleFont: {
                                    family: "'Host Grotesk', sans-serif",
                                    size: 16,
                                    weight: 'bold',
                                },
                                titleColor: 'rgba(0, 0, 0, 0.9)',
                                bodyFont: {
                                    family: "'Host Grotesk', sans-serif",
                                    size: 20,
                                    weight: 'bold',
                                },
                                bodyColor: 'var(--egg-yellow)',
                                padding: 12,
                                displayColors: false, // removes the color box in tooltip
                                callbacks: {
                                    title: function(context) {
                                        return context[0].label; // Date/period
                                    },
                                    label: function(context) {
                                        return `$${context.raw.toFixed(2)} / dozen`; // Price formatted as currency
                                    }
                                }
                            },
                            annotation: {
                                annotations: {
                                    presidentalTerms: [{
                                        type: 'box',
                                        xMin: '2014 Jan',
                                        xMax: '2017 Jan',
                                        backgroundColor: 'var(--democrat-blue)',
                                        borderWidth: 0,
                                        drawTime: 'beforeDatasetsDraw'
                                    }, {
                                        type: 'box',
                                        xMin: '2017 Jan',
                                        xMax: '2021 Jan',
                                        backgroundColor: 'var(--republican-red)',
                                        borderWidth: 0,
                                        drawTime: 'beforeDatasetsDraw'
                                    }, {
                                        type: 'box',
                                        xMin: '2021 Jan',
                                        xMax: labels[labels.length - 1], // Current date
                                        backgroundColor: 'var(--democrat-blue)',
                                        borderWidth: 0,
                                        drawTime: 'beforeDatasetsDraw'
                                    }]
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false // removes vertical grid lines
                                },
                                ticks: {
                                    font: {
                                        family: "'Host Grotesk', sans-serif",
                                        size: 12
                                    }
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(75, 46, 21, 0.1)', // subtle horizontal grid lines
                                },
                                ticks: {
                                    font: {
                                        family: "'Host Grotesk', sans-serif",
                                        size: 12
                                    },
                                    callback: function(value) {
                                        return '$' + value.toFixed(2); // Format y-axis labels as currency
                                    }
                                }
                            }
                        }
                    }
                });

                console.log(data);
                // Update insights with dates
                const lastDataPoint = data[0];
                const currentDate = `${lastDataPoint.periodName} ${lastDataPoint.year}`;
                document.getElementById("currentPrice").textContent = `$${prices[prices.length - 1].toFixed(2)}`;
                document.getElementById("currentDate").textContent = `as of ${currentDate}`;
                document.getElementById("currentDateFAQ").textContent = `${currentDate}`;
                document.getElementById("currentPriceFAQ").textContent = `$${prices[prices.length - 1].toFixed(2)}`;

                const highestPrice = Math.max(...prices);
                const highestIndex = prices.indexOf(highestPrice);
                const highestDate = `${data[prices.length - 1 - highestIndex].periodName} ${data[prices.length - 1 - highestIndex].year}`;
                document.getElementById("highestPrice").textContent = `$${highestPrice.toFixed(2)}`;
                document.getElementById("highestDate").textContent = `reached ${highestDate}`;

                const lowestPrice = Math.min(...prices);
                const lowestIndex = prices.indexOf(lowestPrice);
                const lowestDate = `${data[prices.length - 1 - lowestIndex].periodName} ${data[prices.length - 1 - lowestIndex].year}`;
                document.getElementById("lowestPrice").textContent = `$${lowestPrice.toFixed(2)}`;
                document.getElementById("lowestDate").textContent = `reached ${lowestDate}`;

                const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;
                document.getElementById("averagePrice").textContent = `$${avgPrice.toFixed(2)}`;
            } catch (error) {
                console.error("Failed to fetch egg prices:", error);
            }
        }

        // Load data on page load
        window.onload = () => fetchEggPrices();
    </script>

    <script>
        async function fetchNews() {
            const feed = document.getElementById('news-feed');
            const loading = document.getElementById('news-loading');
            const error = document.getElementById('news-error');

            try {
                loading.style.display = 'block';
                error.style.display = 'none';
                feed.innerHTML = '';

                const response = await fetch('/api/news');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const articles = await response.json();

                if (articles.length === 0) {
                    feed.innerHTML = '<li class="text-center py-4 text-gray-600">No news articles available</li>';
                    return;
                }

                articles.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

                articles.forEach((article) => {
                    const date = new Date(article.pubDate);
                    const formattedDate = date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    const item = document.createElement('li');
                    item.classList.add('border-b', 'border-gray-200', 'last:border-0', 'pb-3', 'last:pb-0');
                    item.innerHTML = `
            <a href="${article.link}" target="_blank" rel="noopener noreferrer" class="group block hover:bg-gray-50 transition duration-75 rounded p-2 -mx-2">
              <h3 class="text-sm font-semibold text-egg-brown">${article.title}</h3>
              <p class="text-xs text-gray-600 mt-1">${formattedDate}</p>
            </a>
          `;
                    feed.appendChild(item);
                });
            } catch (error) {
                console.error('Error fetching news:', error);
                error.style.display = 'block';
                error.textContent = 'Failed to load news. Please try again later.';
            } finally {
                loading.style.display = 'none';
            }
        }

        // Load news on page load
        fetchNews();
    </script>
</body>

</html>